#! /usr/bin/env node
'use strict';var PQueue=require('p-queue'),request=require('request-promise'),cheerio=require('cheerio'),json=require('jsonfile'),argv=require('yargs').argv,ms=require('ms'),progress=require('progress'),start=+new Date,page=1,links=[],bar=new progress(':bar :percent',{total:argv.limit,width:20}),queue=new PQueue({concurrency:1}),crawl=function(a){var b=cheerio.load(a);b(argv.list).length&&page<=argv.limit?(bar.tick(1),b(argv.list).each(function(c,d){links.push({url:b(d).find(argv.link).attr('href'),text:b(d).find(argv.title).text().trim().replace(/[\n\t]/g,'')})}),queue.add(function(){return request(''+argv.site+ ++page)}).then(crawl)):(console.log('Completed in '+ms(+new Date-start)+'.\n'+links.length+' link saved to report.json file.'),json.writeFileSync(process.cwd()+'/report.json',links))};queue.add(function(){return request(''+argv.site+page)}).then(crawl);
